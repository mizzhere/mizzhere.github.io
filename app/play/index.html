<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đánh cược</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Unbounded:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Unbounded', 'sans-serif'],
                    },
                    colors: {
                        dark: {
                            bg: '#09090b', // Zinc 950
                            surface: '#18181b', // Zinc 900
                            border: '#27272a', // Zinc 800
                        },
                        light: {
                            bg: '#ffffff',
                            surface: '#f4f4f5', // Zinc 100
                            border: '#e4e4e7', // Zinc 200
                        }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.3s ease-out',
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1)',
                        'pop': 'pop 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'bounce-in': 'bounceIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55)',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        },
                        pop: {
                            '0%': { transform: 'scale(0.95)' },
                            '50%': { transform: 'scale(1.02)' },
                            '100%': { transform: 'scale(1)' },
                        },
                        bounceIn: {
                            '0%': { transform: 'scale(0)' },
                            '60%': { transform: 'scale(1.1)' },
                            '100%': { transform: 'scale(1)' }
                        }
                    }
                }
            }
        }
    </script>

    <!-- React & Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        ::-webkit-scrollbar-thumb {
            background: #52525b;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #71717a;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        body {
            overflow: hidden; /* Prevent body scroll */
        }
        /* Hide number input spinners */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
</head>
<body class="antialiased transition-colors duration-300">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, createContext, useContext, useRef } = React;

        // --- Utils & Hooks ---

        const generateId = () => Math.random().toString(36).substr(2, 9);

        // Toast System
        const ToastContext = createContext();
        const useToast = () => useContext(ToastContext);

        const ToastProvider = ({ children }) => {
            const [toasts, setToasts] = useState([]);

            const addToast = (message, type = 'info') => {
                const id = generateId();
                setToasts(prev => [...prev, { id, message, type }]);
                setTimeout(() => removeToast(id), 3000);
            };

            const removeToast = (id) => {
                setToasts(prev => prev.filter(t => t.id !== id));
            };

            return (
                <ToastContext.Provider value={{ addToast }}>
                    {children}
                    <div className="fixed bottom-4 right-4 z-50 flex flex-col gap-2 pointer-events-none">
                        {toasts.map(toast => (
                            <div key={toast.id} className={`pointer-events-auto min-w-[250px] p-4 rounded-lg shadow-lg border animate-slide-up flex items-center gap-3
                                ${toast.type === 'error' ? 'bg-red-500/10 border-red-500 text-red-500' : 
                                  toast.type === 'success' ? 'bg-emerald-500/10 border-emerald-500 text-emerald-500' : 
                                  'bg-zinc-800 border-zinc-700 text-zinc-100'}`}>
                                <span className="text-sm font-medium font-sans">{toast.message}</span>
                            </div>
                        ))}
                    </div>
                </ToastContext.Provider>
            );
        };

        // LocalStorage Hook
        const useLocalStorage = (key, initialValue) => {
            const [storedValue, setStoredValue] = useState(() => {
                try {
                    const item = window.localStorage.getItem(key);
                    return item ? JSON.parse(item) : initialValue;
                } catch (error) {
                    console.error(error);
                    return initialValue;
                }
            });

            const setValue = (value) => {
                try {
                    const valueToStore = value instanceof Function ? value(storedValue) : value;
                    setStoredValue(valueToStore);
                    window.localStorage.setItem(key, JSON.stringify(valueToStore));
                } catch (error) {
                    console.error(error);
                }
            };
            return [storedValue, setValue];
        };

        // --- Components ---

        const Button = ({ children, onClick, variant = 'primary', className = '', ...props }) => {
            const baseStyle = "px-4 py-2 rounded-lg font-medium transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed font-sans flex items-center justify-center gap-2";
            const variants = {
                primary: "bg-indigo-600 hover:bg-indigo-500 text-white shadow-lg shadow-indigo-500/20",
                secondary: "bg-zinc-200 dark:bg-zinc-800 hover:bg-zinc-300 dark:hover:bg-zinc-700 text-zinc-900 dark:text-zinc-100",
                danger: "bg-red-500/10 hover:bg-red-500/20 text-red-600 dark:text-red-400 border border-red-500/20",
                ghost: "hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-600 dark:text-zinc-400",
                success: "bg-emerald-600 hover:bg-emerald-500 text-white shadow-lg shadow-emerald-500/20",
                outline: "border-2 border-zinc-200 dark:border-zinc-700 hover:border-indigo-500 text-zinc-600 dark:text-zinc-300 hover:text-indigo-500"
            };

            return (
                <button onClick={onClick} className={`${baseStyle} ${variants[variant]} ${className}`} {...props}>
                    {children}
                </button>
            );
        };

        const Card = ({ children, className = '' }) => (
            <div className={`bg-white dark:bg-dark-surface border border-zinc-200 dark:border-dark-border rounded-xl shadow-sm p-6 ${className}`}>
                {children}
            </div>
        );

        const Input = ({ label, ...props }) => (
            <div className="flex flex-col gap-1.5">
                {label && <label className="text-xs font-semibold uppercase tracking-wider text-zinc-500 dark:text-zinc-400">{label}</label>}
                <input 
                    className="w-full bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-700 rounded-lg px-3 py-2 text-zinc-900 dark:text-zinc-100 focus:outline-none focus:ring-2 focus:ring-indigo-500/50 transition-all font-sans"
                    {...props}
                />
            </div>
        );

        const Modal = ({ isOpen, onClose, title, children }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm animate-fade-in p-4">
                    <div className="bg-white dark:bg-dark-surface w-full max-w-md rounded-2xl shadow-2xl border border-zinc-200 dark:border-dark-border animate-pop overflow-hidden flex flex-col max-h-[90vh]">
                        <div className="p-4 border-b border-zinc-100 dark:border-zinc-800 flex justify-between items-center">
                            <h3 className="font-display font-bold text-lg text-zinc-900 dark:text-white">{title}</h3>
                            <button onClick={onClose} className="p-1 hover:bg-zinc-100 dark:hover:bg-zinc-800 rounded-full transition-colors">
                                <i data-lucide="x" className="w-5 h-5 text-zinc-500"></i>
                            </button>
                        </div>
                        <div className="p-6 overflow-y-auto">
                            {children}
                        </div>
                    </div>
                </div>
            );
        };

        // --- Game Logic Components ---

        const Dashboard = ({ data, setData, onStartGame }) => {
            const { addToast } = useToast();
            const [newTeamName, setNewTeamName] = useState('');
            const [isAddQuestionOpen, setIsAddQuestionOpen] = useState(false);
            const [editingQuestion, setEditingQuestion] = useState(null);
            const [defaultScore, setDefaultScore] = useState(100);

            // Question Form State
            const [qForm, setQForm] = useState({ statement: '', explanation: '', answer: true });

            const addTeam = (e) => {
                e.preventDefault();
                if (!newTeamName.trim()) return;
                setData(prev => ({
                    ...prev,
                    teams: [...prev.teams, { id: generateId(), name: newTeamName, score: defaultScore }]
                }));
                setNewTeamName('');
                addToast(`Đã thêm đội chơi (Điểm: ${defaultScore})`, 'success');
            };

            const removeTeam = (id) => {
                setData(prev => ({ ...prev, teams: prev.teams.filter(t => t.id !== id) }));
            };
            
            const updateTeamScore = (id, newScore) => {
                 setData(prev => ({
                    ...prev,
                    teams: prev.teams.map(t => t.id === id ? { ...t, score: parseInt(newScore) || 0 } : t)
                }));
            }

            const saveQuestion = () => {
                if (!qForm.statement.trim()) {
                    addToast('Vui lòng nhập luận điểm', 'error');
                    return;
                }
                
                const newQ = {
                    id: editingQuestion ? editingQuestion.id : generateId(),
                    ...qForm
                };

                if (editingQuestion) {
                    setData(prev => ({
                        ...prev,
                        questions: prev.questions.map(q => q.id === editingQuestion.id ? newQ : q)
                    }));
                    addToast('Đã cập nhật câu hỏi', 'success');
                } else {
                    setData(prev => ({
                        ...prev,
                        questions: [...prev.questions, newQ]
                    }));
                    addToast('Đã thêm câu hỏi mới', 'success');
                }
                setIsAddQuestionOpen(false);
                setEditingQuestion(null);
                setQForm({ statement: '', explanation: '', answer: true });
            };

            const deleteQuestion = (id) => {
                 setData(prev => ({ ...prev, questions: prev.questions.filter(q => q.id !== id) }));
            };

            const openEdit = (q) => {
                setEditingQuestion(q);
                setQForm({ statement: q.statement, explanation: q.explanation, answer: q.answer });
                setIsAddQuestionOpen(true);
            };

            return (
                <div className="max-w-6xl mx-auto space-y-8 animate-slide-up pb-20">
                    <header className="flex justify-between items-end border-b border-zinc-200 dark:border-zinc-800 pb-6">
                        <div>
                            <h1 className="text-3xl font-display font-bold text-zinc-900 dark:text-white">Thiết lập trò chơi</h1>
                            <p className="text-zinc-500 mt-2">Quản lý đội chơi và ngân hàng câu hỏi</p>
                        </div>
                        <Button onClick={onStartGame} disabled={data.teams.length === 0 || data.questions.length === 0} className="px-8 py-3 text-lg">
                            <i data-lucide="play-circle" className="w-5 h-5"></i> Bắt đầu Game
                        </Button>
                    </header>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        {/* Teams Section */}
                        <div className="space-y-4">
                            <div className="flex items-center justify-between">
                                <h2 className="text-xl font-display font-semibold dark:text-zinc-200">Đội chơi ({data.teams.length})</h2>
                                <div className="flex items-center gap-2">
                                    <span className="text-xs text-zinc-500 uppercase">Điểm khởi tạo</span>
                                    <input 
                                        type="number" 
                                        value={defaultScore}
                                        onChange={(e) => setDefaultScore(parseInt(e.target.value) || 0)}
                                        className="w-16 bg-zinc-100 dark:bg-zinc-800 border-none rounded p-1 text-center font-bold"
                                    />
                                </div>
                            </div>
                            <Card>
                                <form onSubmit={addTeam} className="flex gap-2 mb-4">
                                    <Input 
                                        placeholder="Tên đội..." 
                                        value={newTeamName} 
                                        onChange={e => setNewTeamName(e.target.value)} 
                                    />
                                    <Button type="submit" variant="secondary"><i data-lucide="plus"></i></Button>
                                </form>
                                <div className="space-y-2 max-h-[300px] overflow-y-auto pr-1">
                                    {data.teams.length === 0 && <p className="text-sm text-zinc-400 text-center py-4">Chưa có đội nào</p>}
                                    {data.teams.map(team => (
                                        <div key={team.id} className="flex justify-between items-center p-3 bg-zinc-50 dark:bg-zinc-900/50 rounded-lg border border-zinc-200 dark:border-zinc-700/50">
                                            <span className="font-semibold dark:text-zinc-200">{team.name}</span>
                                            <div className="flex items-center gap-2">
                                                <input 
                                                    type="number"
                                                    value={team.score}
                                                    onChange={(e) => updateTeamScore(team.id, e.target.value)}
                                                    className="w-16 bg-transparent border border-zinc-200 dark:border-zinc-700 rounded px-1 text-right font-mono"
                                                />
                                                <button onClick={() => removeTeam(team.id)} className="text-zinc-400 hover:text-red-500 transition-colors">
                                                    <i data-lucide="trash-2" className="w-4 h-4"></i>
                                                </button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </Card>
                        </div>

                        {/* Questions Section */}
                        <div className="lg:col-span-2 space-y-4">
                            <div className="flex items-center justify-between">
                                <h2 className="text-xl font-display font-semibold dark:text-zinc-200">Ngân hàng câu hỏi ({data.questions.length})</h2>
                                <Button onClick={() => { setEditingQuestion(null); setQForm({statement:'', explanation:'', answer:true}); setIsAddQuestionOpen(true); }} variant="secondary">
                                    <i data-lucide="plus"></i> Thêm câu hỏi
                                </Button>
                            </div>
                            
                            <div className="grid gap-4">
                                {data.questions.length === 0 && (
                                    <div className="text-center py-12 border-2 border-dashed border-zinc-200 dark:border-zinc-800 rounded-xl">
                                        <p className="text-zinc-400">Chưa có câu hỏi nào. Hãy thêm mới!</p>
                                    </div>
                                )}
                                {data.questions.map((q, idx) => (
                                    <Card key={q.id} className="relative group hover:border-indigo-500/30 transition-colors">
                                        <div className="absolute top-4 right-4 flex gap-2 opacity-0 group-hover:opacity-100 transition-opacity">
                                            <button onClick={() => openEdit(q)} className="p-2 bg-zinc-100 dark:bg-zinc-800 rounded-md hover:text-indigo-500"><i data-lucide="edit-2" className="w-4 h-4"></i></button>
                                            <button onClick={() => deleteQuestion(q.id)} className="p-2 bg-zinc-100 dark:bg-zinc-800 rounded-md hover:text-red-500"><i data-lucide="trash" className="w-4 h-4"></i></button>
                                        </div>
                                        <div className="flex gap-4">
                                            <span className="text-xs font-bold text-zinc-400 font-display">#{idx + 1}</span>
                                            <div className="flex-1">
                                                <h3 className="text-lg font-medium text-zinc-900 dark:text-zinc-100 mb-2">{q.statement}</h3>
                                                <div className="flex gap-3 items-center text-sm">
                                                    <span className={`px-2 py-0.5 rounded text-xs font-bold uppercase ${q.answer ? 'bg-emerald-500/10 text-emerald-500' : 'bg-red-500/10 text-red-500'}`}>
                                                        {q.answer ? 'Đúng' : 'Sai'}
                                                    </span>
                                                    <span className="text-zinc-500 truncate max-w-md">{q.explanation}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </Card>
                                ))}
                            </div>
                        </div>
                    </div>

                    <Modal isOpen={isAddQuestionOpen} onClose={() => setIsAddQuestionOpen(false)} title={editingQuestion ? "Sửa câu hỏi" : "Thêm câu hỏi mới"}>
                        <div className="space-y-4">
                            <Input 
                                label="Luận điểm / Câu hỏi" 
                                placeholder="Ví dụ: Trái đất hình vuông?" 
                                value={qForm.statement}
                                onChange={e => setQForm({...qForm, statement: e.target.value})}
                            />
                            
                            <div>
                                <label className="text-xs font-semibold uppercase tracking-wider text-zinc-500 dark:text-zinc-400 block mb-2">Đáp án đúng</label>
                                <div className="flex bg-zinc-100 dark:bg-zinc-900 rounded-lg p-1">
                                    <button 
                                        className={`flex-1 py-2 rounded-md text-sm font-semibold transition-all ${qForm.answer ? 'bg-emerald-500 text-white shadow-md' : 'text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-200'}`}
                                        onClick={() => setQForm({...qForm, answer: true})}
                                    >
                                        ĐÚNG
                                    </button>
                                    <button 
                                        className={`flex-1 py-2 rounded-md text-sm font-semibold transition-all ${!qForm.answer ? 'bg-red-500 text-white shadow-md' : 'text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-200'}`}
                                        onClick={() => setQForm({...qForm, answer: false})}
                                    >
                                        SAI
                                    </button>
                                </div>
                            </div>

                            <Input 
                                label="Giải thích (Hiện sau khi công bố)" 
                                placeholder="Giải thích ngắn gọn..." 
                                value={qForm.explanation}
                                onChange={e => setQForm({...qForm, explanation: e.target.value})}
                            />

                            <div className="pt-4 flex justify-end gap-2">
                                <Button variant="ghost" onClick={() => setIsAddQuestionOpen(false)}>Hủy</Button>
                                <Button onClick={saveQuestion}>Lưu lại</Button>
                            </div>
                        </div>
                    </Modal>
                </div>
            );
        };

        // Màn hình Game Play (Projector View Interactive)
        const GamePlay = ({ data, setData, onBack }) => {
            const { addToast } = useToast();
            const [currentQIndex, setCurrentQIndex] = useState(0);
            const [isRevealed, setIsRevealed] = useState(false);
            
            // Bets state: { teamId: { choice: boolean | null, amount: number, isConfirmed: boolean } }
            const [bets, setBets] = useState({});
            
            // View Mode is now effectively always PROJECTOR/INTERACTIVE based on user request, 
            // but we keep the structure just in case needed.
            const [viewMode, setViewMode] = useState('PROJECTOR'); 
            const [isFullscreen, setIsFullscreen] = useState(false);

            const currentQ = data.questions[currentQIndex];

            // Init bets structure for current question
            useEffect(() => {
                const initialBets = {};
                data.teams.forEach(t => {
                    initialBets[t.id] = { choice: null, amount: 0, isConfirmed: false };
                });
                setBets(initialBets);
            }, [currentQIndex, data.teams]);

            // --- Handlers for Interactive Betting ---

            const handleBetChoice = (teamId, choice) => {
                setBets(prev => ({
                    ...prev,
                    [teamId]: { ...prev[teamId], choice }
                }));
            };

            const handleBetAmount = (teamId, val) => {
                setBets(prev => ({
                    ...prev,
                    [teamId]: { ...prev[teamId], amount: parseInt(val) || 0 }
                }));
            };

            const confirmBet = (teamId) => {
                const bet = bets[teamId];
                if (bet.choice === null) {
                    addToast('Vui lòng chọn ĐÚNG hoặc SAI!', 'error');
                    return;
                }
                if (bet.amount <= 0 && bet.amount !== 0) { // Allow 0 bet? User said "Bấm số điểm muốn cược", implying > 0 usually
                     addToast('Vui lòng nhập số điểm!', 'error');
                     return;
                }

                setBets(prev => ({
                    ...prev,
                    [teamId]: { ...prev[teamId], isConfirmed: true }
                }));
            };

            const unlockBet = (teamId) => {
                if (isRevealed) return; // Cannot unlock after reveal
                setBets(prev => ({
                    ...prev,
                    [teamId]: { ...prev[teamId], isConfirmed: false }
                }));
            };

            const revealAnswer = () => {
                // Check if all teams confirmed? Or just force reveal?
                // User said "Sau khi cả 2 đội đều xong thao tác cược... thì màn hình hiện 1 nút (hiện đáp án)"
                // We'll calculate scores here.
                
                const newTeams = data.teams.map(team => {
                    const bet = bets[team.id];
                    // Only apply score if confirmed and made a choice
                    if (bet && bet.isConfirmed && bet.choice !== null) {
                        const isCorrect = bet.choice === currentQ.answer;
                        return {
                            ...team,
                            score: team.score + (isCorrect ? bet.amount : -bet.amount)
                        };
                    }
                    return team;
                });

                setData(prev => ({ ...prev, teams: newTeams }));
                setIsRevealed(true);
            };

            const nextQuestion = () => {
                if (currentQIndex < data.questions.length - 1) {
                    setCurrentQIndex(prev => prev + 1);
                    setIsRevealed(false);
                } else {
                    addToast('Đã hết câu hỏi!', 'info');
                }
            };

            const toggleFullscreen = () => {
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                    setIsFullscreen(true);
                } else {
                    if (document.exitFullscreen) {
                        document.exitFullscreen();
                        setIsFullscreen(false);
                    }
                }
            };

            // Main Interactive Projector Interface
            return (
                <div className="fixed inset-0 z-50 bg-dark-bg flex flex-col items-center p-6 select-none overflow-hidden">
                    
                    {/* Header Controls */}
                    <div className="absolute top-4 right-4 flex gap-2 opacity-30 hover:opacity-100 transition-opacity z-50">
                        <button onClick={toggleFullscreen} className="text-white p-2 bg-white/10 rounded-full hover:bg-white/20"><i data-lucide={isFullscreen ? "minimize" : "maximize"}></i></button>
                        <button onClick={onBack} className="text-white p-2 bg-white/10 rounded-full hover:bg-white/20"><i data-lucide="x"></i></button>
                    </div>

                    {/* Question Display */}
                    <div className={`w-full max-w-6xl text-center space-y-6 transition-all duration-700 ${isRevealed ? 'mt-4 scale-90' : 'mt-10'}`}>
                        <div className="inline-block px-6 py-2 rounded-full border border-indigo-500/30 bg-indigo-500/10 text-indigo-400 font-display font-bold tracking-widest text-lg">
                            CÂU HỎI #{currentQIndex + 1}
                        </div>
                        <h1 className="text-4xl md:text-5xl lg:text-6xl font-display font-bold text-white leading-tight drop-shadow-2xl px-4">
                            {currentQ.statement}
                        </h1>
                    </div>

                    {/* Main Interaction Area - Team Cards */}
                    <div className="flex-1 w-full max-w-7xl flex items-center justify-center gap-6 p-4">
                        {data.teams.map(team => {
                            const bet = bets[team.id] || { choice: null, amount: 0, isConfirmed: false };
                            const isCorrect = bet.choice === currentQ.answer;
                            
                            return (
                                <div key={team.id} className={`relative w-full max-w-md bg-dark-surface/50 backdrop-blur-sm border-2 rounded-2xl p-6 transition-all duration-500 flex flex-col gap-4
                                    ${isRevealed 
                                        ? (bet.isConfirmed 
                                            ? (isCorrect ? 'border-emerald-500 bg-emerald-900/10' : 'border-red-500 bg-red-900/10')
                                            : 'border-zinc-700 opacity-50')
                                        : (bet.isConfirmed ? 'border-indigo-500/50 bg-indigo-900/10' : 'border-zinc-700')
                                    }
                                `}>
                                    {/* Header: Name & Score */}
                                    <div className="flex justify-between items-center border-b border-white/10 pb-4">
                                        <div className="font-display font-bold text-xl text-white tracking-wide">{team.name}</div>
                                        <div className="font-mono font-bold text-3xl text-white">{team.score}</div>
                                    </div>

                                    {/* Interaction Body */}
                                    <div className="flex-1 flex flex-col justify-center min-h-[200px]">
                                        
                                        {/* State: REVEALED */}
                                        {isRevealed ? (
                                            <div className="text-center space-y-2 animate-bounce-in">
                                                {bet.isConfirmed ? (
                                                    <>
                                                        <div className={`text-6xl font-black ${isCorrect ? 'text-emerald-500' : 'text-red-500'}`}>
                                                            {isCorrect ? '+' : '-'}{bet.amount}
                                                        </div>
                                                        <div className="text-zinc-400 font-bold uppercase tracking-widest">
                                                            Đã chọn: {bet.choice ? 'ĐÚNG' : 'SAI'}
                                                        </div>
                                                    </>
                                                ) : (
                                                    <div className="text-zinc-500 italic">Không tham gia</div>
                                                )}
                                            </div>
                                        ) : (
                                            /* State: BETTING (Confirmed vs Not Confirmed) */
                                            bet.isConfirmed ? (
                                                <div className="text-center space-y-4 animate-pop cursor-pointer" onClick={() => unlockBet(team.id)}>
                                                    <div className="text-zinc-400 text-sm uppercase tracking-widest">Đã chốt phương án</div>
                                                    <div className={`text-4xl font-black ${bet.choice ? 'text-emerald-400' : 'text-red-400'}`}>
                                                        {bet.choice ? 'ĐÚNG' : 'SAI'}
                                                    </div>
                                                    <div className="text-3xl font-mono text-white font-bold">
                                                        {bet.amount} <span className="text-sm text-zinc-500">điểm</span>
                                                    </div>
                                                    <div className="text-xs text-zinc-500 mt-4">(Bấm để sửa lại)</div>
                                                </div>
                                            ) : (
                                                <div className="space-y-4">
                                                    {/* Choice Buttons */}
                                                    <div className="grid grid-cols-2 gap-3 h-16">
                                                        <button 
                                                            onClick={() => handleBetChoice(team.id, true)}
                                                            className={`rounded-xl font-bold text-lg transition-all border-2 ${bet.choice === true ? 'bg-emerald-600 border-emerald-400 text-white shadow-[0_0_20px_rgba(16,185,129,0.4)]' : 'bg-dark-surface border-zinc-700 text-zinc-400 hover:border-zinc-500'}`}
                                                        >
                                                            ĐÚNG
                                                        </button>
                                                        <button 
                                                            onClick={() => handleBetChoice(team.id, false)}
                                                            className={`rounded-xl font-bold text-lg transition-all border-2 ${bet.choice === false ? 'bg-red-600 border-red-400 text-white shadow-[0_0_20px_rgba(239,68,68,0.4)]' : 'bg-dark-surface border-zinc-700 text-zinc-400 hover:border-zinc-500'}`}
                                                        >
                                                            SAI
                                                        </button>
                                                    </div>

                                                    {/* Amount Input */}
                                                    <div className="flex gap-2">
                                                        <input 
                                                            type="number" 
                                                            value={bet.amount || ''}
                                                            onChange={(e) => handleBetAmount(team.id, e.target.value)}
                                                            onKeyDown={(e) => e.key === 'Enter' && confirmBet(team.id)}
                                                            placeholder="0"
                                                            className="w-full bg-dark-bg border-2 border-zinc-700 rounded-xl px-4 py-3 text-center font-mono text-2xl font-bold text-white focus:border-indigo-500 outline-none transition-colors"
                                                        />
                                                    </div>
                                                    
                                                    {/* Quick Amounts */}
                                                    <div className="flex justify-between gap-2">
                                                        {[10, 50, 100].map(val => (
                                                            <button key={val} onClick={() => handleBetAmount(team.id, val)} className="flex-1 py-1 bg-zinc-800 rounded text-xs font-mono text-zinc-400 hover:bg-zinc-700 hover:text-white transition-colors">{val}</button>
                                                        ))}
                                                        <button onClick={() => handleBetAmount(team.id, team.score)} className="flex-1 py-1 bg-red-900/30 rounded text-xs font-mono text-red-400 hover:bg-red-900/50 transition-colors">ALL</button>
                                                    </div>

                                                    {/* Confirm Button */}
                                                    <button 
                                                        onClick={() => confirmBet(team.id)}
                                                        className="w-full py-3 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded-xl shadow-lg shadow-indigo-500/20 active:scale-95 transition-all mt-2"
                                                    >
                                                        XÁC NHẬN
                                                    </button>
                                                </div>
                                            )
                                        )}
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {/* Footer / Main Game Controls */}
                    <div className="w-full max-w-4xl p-6 flex justify-center items-center gap-6">
                        {isRevealed ? (
                            <div className="flex flex-col items-center gap-4 animate-slide-up w-full">
                                <div className={`text-4xl font-black font-display px-8 py-2 rounded-2xl bg-black/50 backdrop-blur border-2 ${currentQ.answer ? 'border-emerald-500 text-emerald-400' : 'border-red-500 text-red-400'}`}>
                                    ĐÁP ÁN: {currentQ.answer ? 'ĐÚNG' : 'SAI'}
                                </div>
                                <div className="text-zinc-400 text-center max-w-2xl text-lg font-light leading-relaxed">
                                    {currentQ.explanation}
                                </div>
                                <button 
                                    onClick={nextQuestion}
                                    className="mt-4 px-12 py-4 bg-white text-black font-display font-bold text-xl rounded-full hover:scale-105 active:scale-95 transition-all shadow-[0_0_30px_rgba(255,255,255,0.3)] flex items-center gap-3"
                                >
                                    CÂU TIẾP THEO <i data-lucide="arrow-right"></i>
                                </button>
                            </div>
                        ) : (
                            <button 
                                onClick={revealAnswer}
                                disabled={data.teams.every(t => !bets[t.id]?.isConfirmed)}
                                className="px-12 py-4 bg-gradient-to-r from-indigo-600 to-purple-600 disabled:opacity-30 disabled:cursor-not-allowed text-white font-display font-bold text-2xl rounded-full hover:scale-105 active:scale-95 transition-all shadow-[0_0_30px_rgba(99,102,241,0.5)] flex items-center gap-3"
                            >
                                <i data-lucide="eye"></i> HIỆN ĐÁP ÁN
                            </button>
                        )}
                    </div>
                </div>
            );
        };

        // --- Main App ---

        const App = () => {
            const [theme, setTheme] = useLocalStorage('theme', 'dark');
            const [data, setData] = useLocalStorage('gameData', {
                teams: [],
                questions: []
            });
            const [screen, setScreen] = useState('DASHBOARD'); // DASHBOARD | GAME

            useEffect(() => {
                if (theme === 'dark') document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
            }, [theme]);

            const toggleTheme = () => setTheme(prev => prev === 'dark' ? 'light' : 'dark');

            // Listen for icons
            useEffect(() => {
                lucide.createIcons();
            }, [screen, data, screen]);

            return (
                <div className="bg-light-bg dark:bg-dark-bg min-h-screen text-zinc-900 dark:text-zinc-100 font-sans selection:bg-indigo-500/30">
                    <ToastProvider>
                        {screen === 'DASHBOARD' && (
                            <div className="h-screen overflow-y-auto custom-scrollbar p-6">
                                <div className="absolute top-6 right-6 z-10">
                                    <button onClick={toggleTheme} className="p-2 rounded-full hover:bg-zinc-200 dark:hover:bg-zinc-800 transition-colors">
                                        <i data-lucide={theme === 'dark' ? 'sun' : 'moon'} className="w-5 h-5"></i>
                                    </button>
                                </div>
                                <Dashboard data={data} setData={setData} onStartGame={() => setScreen('GAME')} />
                            </div>
                        )}
                        
                        {screen === 'GAME' && (
                            <GamePlay data={data} setData={setData} onBack={() => setScreen('DASHBOARD')} />
                        )}
                    </ToastProvider>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
